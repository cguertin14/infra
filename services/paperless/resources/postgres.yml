apiVersion: postgresql.cnpg.io/v1
kind: Cluster
metadata:
  name: paperless-postgres
spec:
  imageName: ghcr.io/cloudnative-pg/postgresql:18-system-trixie
  instances: 1
  
  # Not needed, for now
  # postgresql:

  bootstrap:
    initdb:
      database: paperless-db
      owner: paperless-user
      secret:
        name: paperless-postgres-creds
  # Storage
  storage:
    size: 10Gi
    storageClass: ceph-block
  # Resources
  resources:
    limits:
      memory: 250Mi
    requests:
      cpu: 100m
      memory: 250Mi
  # Run on amd64 nodes
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/arch
            operator: In
            values:
            - amd64